<!--pages/cart/cart.wxml-->
<view class="container">
  <!-- 购物车列表 -->
  <view class="cart-list" wx:if="{{!loading && !hasError && !isEmpty}}">
    <view class="cart-item" wx:for="{{cartList}}" wx:key="id">
      <!-- 选择框 -->
      <view class="checkbox" bindtap="onCheckItem" data-id="{{item.id}}">
        <view class="checkbox-inner {{item.checked ? 'checked' : ''}}"></view>
      </view>
      
      <!-- 商品信息 -->
      <view class="goods-info">
        <view class="goods-image">
          <safe-image 
            src="{{item.goods.image}}" 
            mode="aspectFill"
            default-src="/images/default/goods.png"
          />
        </view>
        <view class="goods-detail">
          <view class="goods-name">{{item.goods.name}}</view>
          <view class="goods-price">¥{{item.goods.price}}</view>
          <view class="quantity-control">
            <button class="quantity-btn" bindtap="onQuantityChange" data-id="{{item.id}}" data-action="minus">-</button>
            <text class="quantity-text">{{item.quantity}}</text>
            <button class="quantity-btn" bindtap="onQuantityChange" data-id="{{item.id}}" data-action="plus">+</button>
          </view>
        </view>
      </view>
      
      <!-- 删除按钮 -->
      <view class="delete-btn" bindtap="onDeleteItem" data-id="{{item.id}}">
        <text class="delete-icon">×</text>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && !hasError && isEmpty}}">
    <view class="empty-icon">🛒</view>
    <view class="empty-text">购物车是空的</view>
    <button class="empty-btn" bindtap="onGoShopping">去购物</button>
  </view>

  <!-- 错误状态 -->
  <view class="error-state" wx:if="{{!loading && hasError}}">
    <view class="error-icon">⚠️</view>
    <view class="error-text">加载失败</view>
    <button class="error-btn" bindtap="onRetry">重新加载</button>
  </view>

  <!-- 底部结算栏 -->
  <view class="checkout-bar" wx:if="{{!isEmpty}}">
    <view class="select-all" bindtap="onSelectAll">
      <view class="checkbox-inner {{selectAll ? 'checked' : ''}}"></view>
      <text class="select-all-text">全选</text>
    </view>
    <view class="total-info">
      <text class="total-text">合计: ¥{{totalPrice}}</text>
      <text class="count-text">已选{{selectedCount}}件</text>
    </view>
    <button class="checkout-btn" bindtap="onCheckout">结算</button>
  </view>

  <!-- 加载组件 -->
  <loading 
    show="{{loading}}" 
    type="spinner" 
    text="加载中..." 
    mask="{{true}}"
  />
</view>