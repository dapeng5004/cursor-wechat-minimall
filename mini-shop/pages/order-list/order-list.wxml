<!--pages/order-list/order-list.wxml-->
<view class="container">
  <!-- çŠ¶æ€ç­›é€‰æ  -->
  <view class="status-bar" wx:if="{{!globalLoading && !hasError}}">
    <view class="status-item {{status === item.value ? 'active' : ''}}" 
          wx:for="{{statusList}}" 
          wx:key="value"
          bindtap="onStatusChange" 
          data-status="{{item.value}}">
      {{item.name}}
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list" wx:if="{{!globalLoading && !hasError && !isEmpty}}">
    <view class="order-item" wx:for="{{orderList}}" wx:key="id">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-no">è®¢å•å·: {{item.orderNo}}</view>
        <view class="order-status {{getStatusColor(item.status)}}">
          {{getStatusText(item.status)}}
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="goods-list">
        <view class="goods-item" wx:for="{{item.goods}}" wx:key="id" wx:for-item="goods">
          <view class="goods-image">
            <safe-image 
              src="{{goods.image}}" 
              mode="aspectFill"
              default-src="/images/default/goods.png"
            />
          </view>
          <view class="goods-info">
            <view class="goods-name">{{goods.name}}</view>
            <view class="goods-price">Â¥{{goods.price}}</view>
            <view class="goods-quantity">x{{goods.quantity}}</view>
          </view>
        </view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info">
        <view class="order-total">
          å…±{{item.totalQuantity}}ä»¶å•†å“ åˆè®¡: Â¥{{item.totalAmount}}
        </view>
        <view class="order-time">{{item.created_at}}</view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="order-actions">
        <button class="action-btn" 
                wx:if="{{item.status === 'pending'}}"
                bindtap="onPayOrder" 
                data-order="{{item}}">
          ç«‹å³æ”¯ä»˜
        </button>
        <button class="action-btn" 
                wx:if="{{item.status === 'pending'}}"
                bindtap="onCancelOrder" 
                data-order="{{item}}">
          å–æ¶ˆè®¢å•
        </button>
        <button class="action-btn" 
                wx:if="{{item.status === 'shipped'}}"
                bindtap="onConfirmReceive" 
                data-order="{{item}}">
          ç¡®è®¤æ”¶è´§
        </button>
        <button class="action-btn" 
                bindtap="onOrderTap" 
                data-order="{{item}}">
          æŸ¥çœ‹è¯¦æƒ…
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!globalLoading && !hasError && isEmpty}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-text">æš‚æ— è®¢å•</view>
    <button class="empty-btn" bindtap="onRetry">åˆ·æ–°é‡è¯•</button>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!globalLoading && hasError}}">
    <view class="error-icon">âš ï¸</view>
    <view class="error-text">åŠ è½½å¤±è´¥</view>
    <button class="error-btn" bindtap="onRetry">é‡æ–°åŠ è½½</button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{!globalLoading && !hasError && !isEmpty}}">
    <loading 
      show="{{loading}}" 
      type="circle" 
      text="åŠ è½½ä¸­..." 
      style="inline"
      mask="{{false}}"
    />
    <view class="no-more" wx:if="{{!hasMore && !loading}}">æ²¡æœ‰æ›´å¤šäº†</view>
  </view>

  <!-- å…¨å±€åŠ è½½ç»„ä»¶ -->
  <loading 
    show="{{globalLoading}}" 
    type="spinner" 
    text="åŠ è½½ä¸­..." 
    mask="{{true}}"
  />
</view>